#!/usr/bin/python
import subprocess

f = open('.shard.tmp', 'w')
procs = []

def procnum(st):
    s = st[st.index('forked process:') + 14:].strip()
    return str(s[2:7])
### Start MongoDB instances
procs.append(procnum(subprocess.check_output(
        "mongod --port 27017 --dbpath ./src/libmongo/test/s1 --logpath ./src/libmongo/test/s1.log --fork --shardsvr".split(' '))))
procs.append(procnum(subprocess.check_output(
        "mongod --port 37017 --dbpath ./src/libmongo/test/s2 --logpath ./src/libmongo/test/s2.log --fork --shardsvr".split(' '))))

### Start config servers
procs.append(procnum(subprocess.check_output(
        "mongod --port 47017 --dbpath ./src/libmongo/test/cfg1 --logpath ./src/libmongo/test/cfg1.log --fork --configsvr".split(' '))))
procs.append(procnum(subprocess.check_output(
        "mongod --port 47018 --dbpath ./src/libmongo/test/cfg2 --logpath ./src/libmongo/test/cfg2.log --fork --configsvr".split(' '))))
procs.append(procnum(subprocess.check_output(
        "mongod --port 47018 --dbpath ./src/libmongo/test/cfg3 --logpath ./src/libmongo/test/cfg3.log --fork --configsvr".split(' '))))

### Start shard controller
procs.append(procnum(subprocess.check_output(
        "mongos --port 57017 --logpath src/libmongo/test/mongos.log --fork --configdb localhost:47017,localhost:47018,localhost:47019".split(' '))))
for pn in procs:
    f.write(pn + '\n')
